<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Image</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="bg-white p-6 rounded shadow-md">
        <h1 class="text-2xl font-bold mb-4 text-center">Upload Your Image</h1>
        <input type="file" id="imageUpload" accept="image/*" class="block w-full mb-4 p-2 border rounded">
        <button id="uploadButton" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
            Upload and View
        </button>
    </div>
    <script>
        document.getElementById('uploadButton').addEventListener('click', function () {
            const input = document.getElementById('imageUpload');

            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const img = new Image();
                    img.onload = function () {
                        // Create a canvas to resize the image
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Define the maximum width and height
                        const maxWidth = 1800; // Adjust as needed
                        const maxHeight = 800; // Adjust as needed

                        // Calculate the new dimensions
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > maxWidth) {
                                height = Math.round((height * maxWidth) / width);
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width = Math.round((width * maxHeight) / height);
                                height = maxHeight;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;

                        // Draw the resized image on the canvas
                        ctx.drawImage(img, 0, 0, width, height);

                        // Get the optimized image as a data URL
                        const optimizedImage = canvas.toDataURL('image/jpeg', 0.7); // 0.7 is the quality factor (0-1)

                        // Save the image data to sessionStorage
                        sessionStorage.setItem('uploadedImage', optimizedImage);

                        // Redirect to the display page
                        window.location.href = 'display.html';
                    };
                    img.src = e.target.result;
                };

                reader.readAsDataURL(file);
            } else {
                alert('Please select an image to upload.');
            }
        });
    </script>

    <!-- <script src="https://cdn.jsdelivr.net/npm/pica/dist/pica.min.js"></script>
    <script>
        document.getElementById('uploadButton').addEventListener('click', function () {
            const input = document.getElementById('imageUpload');

            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const img = new Image();
                    img.onload = async function () {
                        const originalWidth = img.width;
                        const originalHeight = img.height;

                        // Create a canvas for resizing
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Define max dimensions
                        const maxWidth = 1200; // Increase this if the quality is too low
                        const maxHeight = 1200;

                        let width = originalWidth;
                        let height = originalHeight;

                        // Resize dimensions while maintaining the aspect ratio
                        if (width > height && width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        } else if (height > maxHeight) {
                            width = Math.round((width * maxHeight) / height);
                            height = maxHeight;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        // Use Pica for high-quality resizing
                        const pica = new Pica();
                        await pica.resize(img, canvas);

                        // Export the resized image
                        canvas.toBlob(
                            (blob) => {
                                const reader = new FileReader();
                                reader.onloadend = () => {
                                    // Save the optimized image to sessionStorage
                                    sessionStorage.setItem('uploadedImage', reader.result);

                                    // Redirect to the display page
                                    window.location.href = 'display.html';
                                };
                                reader.readAsDataURL(blob);
                            },
                            'image/jpeg',
                            0.85 // Adjust quality for large images
                        );
                    };

                    img.src = e.target.result;
                };

                reader.readAsDataURL(file);
            } else {
                alert('Please select an image to upload.');
            }
        });
    </script> -->

</body>

</html>